- en: Inside Agoda’s Private Cloud - Exclusive - The Pragmatic Engineer
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Agoda的私有云内部 - 独家 - 实用工程师
- en: "Original Text: [https://blog.pragmaticengineer.com/inside-agodas-private-cloud/](https://blog.pragmaticengineer.com/inside-agodas-private-cloud/)"
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://blog.pragmaticengineer.com/inside-agodas-private-cloud/](https://blog.pragmaticengineer.com/inside-agodas-private-cloud/)
- en: '*👋 Hi, this is* [*Gergely*](https://pragmaticengineer.com/?ref=blog.pragmaticengineer.com)
    *with the monthly, free issue of the Pragmatic Engineer Newsletter. In every issue,
    I cover challenges at Big Tech and startups through the lens of engineering managers
    and senior engineers.*'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '*👋 嗨，这是* [*Gergely*](https://pragmaticengineer.com/?ref=blog.pragmaticengineer.com)
    *每月免费发布的实用工程师通讯。每期我都会通过工程经理和高级工程师的视角来探讨大型科技公司和初创公司面临的挑战。*'
- en: '*If you’re not a subscriber, you missed the issue on*[](https://newsletter.pragmaticengineer.com/p/staying-technical?ref=blog.pragmaticengineer.com)[*Shopify’s
    leveling split*](https://newsletter.pragmaticengineer.com/p/inside-shopifys-leveling-split?ref=blog.pragmaticengineer.com)
    *and* [*a few others*](https://newsletter.pragmaticengineer.com/archive?ref=blog.pragmaticengineer.com)*.
    Subscribe to get two full issues every week. Many subscribers expense this newsletter
    to their learning and development budget. If you have such a budget, here’s* [*an
    email you could send to your manager*](https://docs.google.com/document/d/1BTgvFmpxNsJX6m9T6duRfZy4jD4CfcySVqoOGSe343I/edit?usp=sharing&ref=blog.pragmaticengineer.com)*.
    To get articles like this every week, [subscribe here](https://newsletter.pragmaticengineer.com/about?ref=blog.pragmaticengineer.com).*'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '*如果您不是订阅者，您可能错过了关于*[](https://newsletter.pragmaticengineer.com/p/staying-technical?ref=blog.pragmaticengineer.com)[*Shopify的分级拆分*](https://newsletter.pragmaticengineer.com/p/inside-shopifys-leveling-split?ref=blog.pragmaticengineer.com)
    *以及* [*其他一些内容*](https://newsletter.pragmaticengineer.com/archive?ref=blog.pragmaticengineer.com)*。订阅以获取每周两期完整的问题。许多订阅者将此通讯费用列入其学习和发展预算。如果您有这样的预算，这里是*
    [*您可以发送给您的经理的电子邮件*](https://docs.google.com/document/d/1BTgvFmpxNsJX6m9T6duRfZy4jD4CfcySVqoOGSe343I/edit?usp=sharing&ref=blog.pragmaticengineer.com)*。要获取每周类似这样的文章，[请在此处订阅](https://newsletter.pragmaticengineer.com/about?ref=blog.pragmaticengineer.com)。*'
- en: In a previous [two-part series](https://newsletter.pragmaticengineer.com/p/inside-ubers-move-to-the-cloud-part?ref=blog.pragmaticengineer.com),
    we dived into Uber’s multi-year project to [move onto the cloud](https://newsletter.pragmaticengineer.com/p/uber-move-to-cloud?ref=blog.pragmaticengineer.com),
    away from operating its own data centers. But there’s no “one size fits all” strategy
    when it comes to deciding the right balance between utilizing the cloud and operating
    your infrastructure on-premises.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在之前的[两部分系列](https://newsletter.pragmaticengineer.com/p/inside-ubers-move-to-the-cloud-part?ref=blog.pragmaticengineer.com)中，我们深入探讨了Uber多年来[转向云端](https://newsletter.pragmaticengineer.com/p/uber-move-to-cloud?ref=blog.pragmaticengineer.com)的项目，远离自己运营的数据中心。但在决定正确平衡利用云端和在本地运营基础设施之间时，并没有“一刀切”的策略。
- en: To show the complexity of this choice and the ways tech businesses approach
    it, this article brings the inside story of one large tech company that’s decided
    against onboarding to the cloud – at least for now.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 展示这个选择的复杂性以及科技企业处理方式的方式，本文揭示了一家大型科技公司的内部故事，该公司决定暂时不使用云端。
- en: '[Agoda](https://www.agoda.com/?ref=blog.pragmaticengineer.com) is a leading
    online travel booking platform in Asia. It’s owned by Booking Holdings Inc, which
    also owns the popular travel sites, Kayak and Booking.com. Unlike Uber, Agoda
    does not make use of public cloud providers, having [decided](https://medium.com/agoda-engineering/private-cloud-and-you-736d8d99a51e?ref=blog.pragmaticengineer.com)
    to build out its own private cloud, instead.'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '[Agoda](https://www.agoda.com/?ref=blog.pragmaticengineer.com)是亚洲领先的在线旅行预订平台。它由Booking
    Holdings Inc拥有，后者还拥有流行的旅行网站Kayak和Booking.com。与Uber不同，Agoda不使用公共云提供商，而是[决定](https://medium.com/agoda-engineering/private-cloud-and-you-736d8d99a51e?ref=blog.pragmaticengineer.com)构建自己的私有云。'
- en: To learn more, I reached out to Agoda’s CTO [Idan Zalzberg](https://www.linkedin.com/in/idan-zalzberg-a2300013?ref=blog.pragmaticengineer.com)
    who generously talked through previously not shared details.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 为了了解更多信息，我联系了Agoda的CTO [Idan Zalzberg](https://www.linkedin.com/in/idan-zalzberg-a2300013?ref=blog.pragmaticengineer.com)，他慷慨地分享了以前未公开的细节。
- en: 'In today’s issue, we cover:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在今天的问题中，我们将涵盖：
- en: '**Agoda in numbers.** The number of developers, physical cores, data centers,
    and more.'
  id: totrans-9
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Agoda的数字。**开发人员数量、物理核心数、数据中心等等。'
- en: '**The hardware inside Agoda’s private cloud**. 64-core compute nodes of around
    20 servers per rack, Top-of-rack (ToR) switches and plenty of redundancy.'
  id: totrans-10
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Agoda私有云中的硬件**。每个机架约有20台64核计算节点，顶部交换机和大量冗余。'
- en: '**Agoda’s cloud strategy and usage.** Is Agoda’s goal to operate off the cloud,
    or on it? What are the use cases where the company already utilizes public cloud?'
  id: totrans-11
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Agoda的云策略和使用情况。** Agoda的目标是在云端运营还是在云端运营？公司已经在哪些用例中利用了公共云？'
- en: '**The cloud or your own data centers?** Idan’s advice for any midsize company
    weighing up on-prem versus public cloud.'
  id: totrans-12
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**云端还是自己的数据中心？** Idan对于任何正在权衡本地与公共云的中型公司的建议。'
- en: 1\. Agoda in numbers
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1. Agoda的数字
- en: Agoda lists 3.6M hotels and holiday properties worldwide, and its apps and website
    appear in 39 languages. The company sees 80K searches per second at peak traffic,
    and serving them all involves calculating 10M different “accomodation rates” per
    second. Interestingly, the majority of these searches are not by holidaymakers
    “browsing right now” during their free time – most searches are by partners, affiliates
    and search engines!
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: Agoda列出了全球3.6百万家酒店和度假屋，其应用程序和网站支持39种语言。该公司在高峰时段每秒处理80,000次搜索，为了满足所有需求，需要每秒计算10百万个不同的“住宿费率”。有趣的是，大多数搜索并不是由度假者在空闲时间“浏览此刻”进行的
    - 大多数搜索来自合作伙伴、联盟和搜索引擎！
- en: The company employs about 6,600 people in 31 markets, with its headquarters
    in Singapore. Around 1,600 people work in engineering, including software engineers,
    data science and business intelligence (BI) teams, and the DevOps team. The majority
    of the engineering team is in Bangkok, Thailand.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 公司在31个市场雇佣了约6600人，总部设在新加坡。大约1600人从事工程工作，包括软件工程师、数据科学和商业智能（BI）团队以及DevOps团队。大多数工程团队位于泰国曼谷。
- en: Among the 1,600 tech workers, the hardware team numbers in the low tens, and
    their job is to maintain the hardware and ensure it operates in DCs as expected.
    This group doesn’t include the software layer for infrastructure, which is a software
    team that builds the orchestration platform (Fleet) upon Kubernetes.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在1600名技术工作者中，硬件团队人数在几十人左右，他们的工作是维护硬件并确保其在数据中心中按预期运行。这个团队不包括基础设施的软件层，这是一个软件团队，负责在Kubernetes上构建编排平台（Fleet）。
- en: Although the company employs about 4-500 people in its data organization, there’s
    been no single dedicated “data team” for around 2 years. Agoda moved away from
    this model and its data engineers are embedded into each team. Within the data
    org, the distinct roles of data scientist, data analyst and data engineer are
    defined. Within data engineering, there is currently no separation between data
    engineers and machine learning (ML) engineers; individuals take on both roles.
    *We go deeper into ML in* [*What is ML engineering?*](https://newsletter.pragmaticengineer.com/p/what-is-ml-engineering?ref=blog.pragmaticengineer.com)
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管公司在其数据组织中雇佣了大约4-500人，但大约2年来没有一个专门的“数据团队”。Agoda摆脱了这种模式，其数据工程师嵌入到每个团队中。在数据组织中，定义了数据科学家、数据分析师和数据工程师的不同角色。在数据工程中，目前没有数据工程师和机器学习（ML）工程师之间的区分；个人承担这两种角色。*我们在*
    [*什么是ML工程？*](https://newsletter.pragmaticengineer.com/p/what-is-ml-engineering?ref=blog.pragmaticengineer.com)
    *中更深入地探讨ML*
- en: The company works in Scrum teams, which typically contain a product manager,
    developers, data scientists/analysts/engineers and BI engineers. The goal of having
    all these people is to create a shared business purpose.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 公司以Scrum团队的形式工作，通常包括产品经理、开发人员、数据科学家/分析师/工程师和BI工程师。拥有所有这些人的目标是创建一个共享的业务目的。
- en: 'Infrastructure-wise, the company operates around 6,500 servers, with a total
    of approximately 600k virtual cores (vCores) and 300k physical cores. The company’s
    largest data cluster is 20-30PB (petabytes: 1PB is 1,000 terabytes or 1M gigabytes).
    Ten years ago, this data cluster was 300GB as a Hadoop cluster; that’s around
    a 100,000-fold increase in data stored!'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在基础设施方面，公司运营大约6500台服务器，总共约60万个虚拟核心（vCores）和30万个物理核心。公司最大的数据集群是20-30PB（PB：1PB等于1000TB或1MGB）。十年前，这个数据集群是一个300GB的Hadoop集群；存储的数据量增加了大约10万倍！
- en: 'The company runs 4 data centers: in the US and Europe, with two in Asia. Agoda
    co-locates in all data centers, leasing space for its racks and the largest data
    center consumes about 1 MW of power. It uses Spark for the data platform. For
    transactional databases, it’s mostly the Microsoft SQL Server, but also other
    databases like PostgreSQL, ScyllaDB and Couchbase. At peak load, Agoda sees around
    7.5M queries per second as total load, spread across its managed database-as-a-service
    (DBAAS.) The company uses HP servers, VAST hardware for object storage. Agoda
    utilizes Akamai as its CDN vendor.'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 公司在美国和欧洲运行4个数据中心，亚洲有两个。Agoda在所有数据中心进行合作，为其机架租赁空间，最大的数据中心消耗约1兆瓦的电力。它使用Spark作为数据平台。对于事务性数据库，主要是Microsoft
    SQL Server，但也包括其他数据库如PostgreSQL、ScyllaDB和Couchbase。在高峰负载时，Agoda看到每秒大约750万个查询作为总负载，分布在其托管的数据库即服务（DBAAS）中。公司使用HP服务器，VAST硬件用于对象存储。Agoda利用Akamai作为其CDN供应商。
- en: 2\. The hardware inside Agoda’s private cloud
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2. Agoda私有云中的硬件
- en: 'Agoda is standardizing its hardware SKUs (stock-keeping unit,) This is a unique
    code for a hardware that captures all the important details. The company standardizes
    SKUs to allow for supply chain optimization and ease of deployment. Typical compute
    nodes have:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: Agoda正在标准化其硬件SKU（库存单位），这是一个捕捉所有重要细节的硬件的唯一代码。公司标准化SKU以实现供应链优化和部署便利。典型的计算节点具有：
- en: 64 cores physical cores, with SMT enabled (128 vCores)
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 64个物理核心，启用SMT（128个虚拟核心）
- en: 512 GB memory
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 512GB内存
- en: 4 TB of storage
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 4TB的存储
- en: 'The company aims to maintain a similar ratio of cores / RAM / disk on all servers
    it buys. Here’s a common configuration:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 公司的目标是在购买的所有服务器上保持相似的核心/内存/磁盘比例。以下是一个常见的配置：
- en: HPE ProLiant DL325 Gen10 Plus v2 Server
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: HPE ProLiant DL325 Gen10 Plus v2服务器
- en: 'CPU: 1x AMD 7763 CPU (64 physical cores)'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CPU：1个AMD 7763 CPU（64个物理核心）
- en: 'Memory: 512 GB of RAM'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 内存：512GB RAM
- en: Storage and 4 TB of NVMe ([nonvolatile memory express](https://www.netapp.com/data-storage/nvme/what-is-nvme?ref=blog.pragmaticengineer.com))
    storage. NVMe is next-generation SSD
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储和4TB的NVMe（[非易失性内存表达](https://www.netapp.com/data-storage/nvme/what-is-nvme?ref=blog.pragmaticengineer.com)）存储。NVMe是下一代SSD
- en: '![The HPE ProLiant DL325 Gen10 Plus v2 Server](../Images/08c6dfde00cfbce7e7ead209ef91119d.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![HPE ProLiant DL325 Gen10 Plus v2服务器](../Images/08c6dfde00cfbce7e7ead209ef91119d.png)'
- en: The HPE ProLiant DL325 Gen10 Plus v2 Server
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: HPE ProLiant DL325 Gen10 Plus v2服务器
- en: Agoda’s racks usually support 6-10 KW of load each, depending on the age of
    the facility. Often, around a dozen servers are deployed on a 6KW rack, equating
    to circa 1.5K vCores which can deploy approximately 20 servers with a 10KW rack,
    or around 2.5K vCores.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: Agoda的机架通常支持每个6-10千瓦的负载，具体取决于设施的年龄。通常，大约有十几台服务器部署在一个6千瓦的机架上，相当于大约1.5K个虚拟核心，可以部署大约20台服务器在一个10千瓦的机架上，或者大约2.5K个虚拟核心。
- en: '![Servers and racks in Agoda’s data centers](../Images/2f4ef5b54c11161a4fc35b3d40e0d874.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![Agoda数据中心中的服务器和机架](../Images/2f4ef5b54c11161a4fc35b3d40e0d874.png)'
- en: Servers and racks in Agoda’s data centers
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: Agoda数据中心中的服务器和机架
- en: The company needs to plan server locations carefully in order to avoid hot spots
    and airflow problems.Each server has 2x25Gbps networking interfaces connected
    to dual switches of one switch per rack, and the cables cross between a rack pair.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 公司需要仔细规划服务器位置，以避免热点和气流问题。每台服务器有2个25Gbps的网络接口连接到每个机架一个交换机的双交换机，并且电缆在机架对之间交叉。
- en: Top-of-rack (ToR) switches connect to end-of-row switches with multiple 100
    Gbps links, which connect to the network core with 2x400 or 4x400 Gbps links,
    depending on row size. Oversubscription, depending on rack density, is between
    1.3:1 and 2:1.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 顶部交换机通过多个100 Gbps链接连接到行末交换机，行末交换机通过2x400或4x400 Gbps链接连接到网络核心，具体取决于行的大小。根据机架密度，过度订阅比例在1.3:1和2:1之间。
- en: '**Oversubscription** in networking terms refers to having less network bandwidth
    available than the total capacity the network can theoretically handle. For example,
    assume a rack with 20 servers, each with a 25 Gbps card. To carry all the network
    capacity of these servers, you need 500 Gbps of bandwidth. However, if the top-of-the-rack
    switch has only 4x100Gbps of bandwidth, then oversubscription is 1.25:1 (500Gbps
    theoretical peak, vs 400 Gbps actual.)'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 在网络术语中，**过度订阅**指的是可用网络带宽少于网络理论上可以处理的总容量。例如，假设一个机架有20台服务器，每台服务器都有一个25 Gbps的网卡。要承载这些服务器的所有网络容量，您需要500
    Gbps的带宽。然而，如果顶部交换机只有4x100Gbps的带宽，那么过度订阅比例为1.25:1（500Gbps理论峰值，与实际的400 Gbps相比）。
- en: Similarly, if you have 10 racks with 400 Gbps bandwidth per rack, you need 4,000
    Gbps bandwidth at the end-of-rack switches. However, assuming 4x400Gbps switches,
    the oversubscription is 2.5:1 (4,000:1,600).
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，如果您有10个每个机架带宽为400 Gbps的机架，您需要在机架末端交换机上有4,000 Gbps的带宽。然而，假设有4个400Gbps交换机，过度订阅比例为2.5:1（4,000:1,600）。
- en: Oversubscription is a pragmatic approach to network planning, when considering
    cost control. Servers rarely use their maximum allocated bandwidth for prolonged
    periods, and it’s even less likely that this happens simultaneously to all servers
    in a rack, or for all racks in a row. In the case of Agoda, oversubscription was
    done after understanding the traffic patterns, and this setup does not interfere
    with being able to handle peak traffic loads.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 过度订阅是网络规划的一种务实方法，考虑到成本控制。服务器很少会长时间使用其分配的最大带宽，而且很少会同时发生所有服务器在一个机架中，或者所有机架在一排中同时发生这种情况。在Agoda的情况下，过度订阅是在了解流量模式之后进行的，这种设置不会影响处理峰值流量负载的能力。
- en: '![Networking setup within Agoda data centers](../Images/b1b02cc9ed8a48b37a473e92c4fa0866.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![Agoda数据中心内的网络设置](../Images/b1b02cc9ed8a48b37a473e92c4fa0866.png)'
- en: Networking setup within Agoda data centers
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: Agoda数据中心内的网络设置
- en: '![A rack inside Agoda’s Singapore data center. The yellow networking cables
    are 25 GPS, and the black ones are power cables](../Images/30d476df9fbb0572d172cdae7053f014.png)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![Agoda新加坡数据中心内的一个机架。黄色的网络电缆是25 GPS，黑色的是电源电缆](../Images/30d476df9fbb0572d172cdae7053f014.png)'
- en: A rack inside Agoda’s Singapore data center. The yellow networking cables are
    25 GPS, and the black ones are power cables
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在Agoda新加坡数据中心内的一个机架。黄色的网络电缆是25 GPS，黑色的是电源电缆
- en: The company uses [Arista](https://www.arista.com/?ref=blog.pragmaticengineer.com)
    equipment in the DC. Due to supply chain issues, hardware refresh work is a bit
    behind, so a decent chunk of the racks are still on 10Gps ports. All of those
    ports are expected to be upgraded by 2024.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 公司在数据中心使用[Arista](https://www.arista.com/?ref=blog.pragmaticengineer.com)设备。由于供应链问题，硬件更新工作有些滞后，因此相当多的机架仍在使用10Gps端口。预计到2024年所有这些端口都将升级。
- en: '**Needless to say, Agoda’s infrastructure is redundant.** The company has two
    of pretty much everything, and redundant networking. They achieve inter-DC connectivity
    through a combination of:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '**毋庸置疑，Agoda的基础设施是冗余的。**公司几乎每样东西都有两份，并且有冗余的网络。他们通过以下方式实现数据中心之间的连接：'
- en: Bandwidth between the main DCs is 40 Gbps, growing to 60 Gbps in the near future.
    It has optimized traffic paths for latency and route critical applications through
    the best circuits.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 主数据中心之间的带宽为40 Gbps，未来将增长到60 Gbps。它为延迟和路由关键应用程序优化了流量路径。
- en: '**To reduce latency, a CDN is used**. From a customer perspective, Agoda utilizes
    a CDN with a large local presence in core geographies, [Akamai](https://www.akamai.com/?ref=blog.pragmaticengineer.com).
    The CDN manages caching and path optimization from the customer to Agoda, mitigating
    some common local access problems of remote locations. It also utilizes this distributed
    platform for security purposes, enriching data sent to the on-prem fraud detection
    platform.'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '**为了减少延迟，使用了CDN**。从客户的角度来看，Agoda利用了一个在核心地理位置具有大量本地存在的CDN，[Akamai](https://www.akamai.com/?ref=blog.pragmaticengineer.com)。CDN管理缓存和路径优化，从客户到Agoda，减轻了一些远程位置常见的本地访问问题。它还利用这个分布式平台进行安全目的，丰富发送到本地欺诈检测平台的数据。'
- en: '**For its data platform**, Agoda builds on top of Spark. For the underlying
    hardware, it uses dual-socket HP Dl385 servers, with:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '**对于其数据平台**，Agoda构建在Spark之上。在底层硬件上，它使用双插槽HP Dl385服务器，具有：'
- en: 2x64-core AMD EPYC 7713 CPUs
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 2x64核AMD EPYC 7713 CPU
- en: 2 TB of RAM
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 2 TB的RAM
- en: 15 TB of NVMe, for caching purposes.
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 15 TB的NVMe，用于缓存目的。
- en: '![A HP Dl385 server](../Images/307d26c9ddd275517e61ce6e9e00d52d.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: 一个HP Dl385服务器
- en: A HP Dl385 server
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 一个HP Dl385服务器
- en: These HP servers run quite hot at 800-900W each, so Agoda can only host 7 or
    so in each rack.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 这些HP服务器运行时相当热，每台消耗800-900W，因此Agoda每个机架只能承载7台左右。
- en: '**For data storage**, it uses an [object store](https://en.wikipedia.org/wiki/Object_storage?ref=blog.pragmaticengineer.com)
    cluster, running on [VAST](https://vastdata.com/?ref=blog.pragmaticengineer.com)
    hardware. In this cluster, around 15 PB of raw data and 21 PB of logical data
    can be stored. More data can be fitted than there is raw storage available thanks
    to VAST’s [data deduplication](https://vastdata.com/blog/data-reduction-redux/?ref=blog.pragmaticengineer.com).'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '**对于数据存储**，它使用运行在[VAST](https://vastdata.com/?ref=blog.pragmaticengineer.com)硬件上的[对象存储](https://en.wikipedia.org/wiki/Object_storage?ref=blog.pragmaticengineer.com)集群。在这个集群中，可以存储大约15
    PB的原始数据和21 PB的逻辑数据。由于VAST的[数据去重](https://vastdata.com/blog/data-reduction-redux/?ref=blog.pragmaticengineer.com)，可以存储更多的数据，超过了可用的原始存储空间。'
- en: '**For transactional work**, Agoda mostly uses Microsoft SQL server (MSSQL,)
    running on physical servers optimized for core performance using low-core count
    and high clock machines. It chose this setup because the Microsoft licensing model
    has a rather steep per-core cost. Licensing costs are around $7,000 per core for
    SQL Server’s enterprise edition, so this approach increases the utilization of
    these licenses.'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 对于交易工作，Agoda主要使用运行在为核心性能优化的物理服务器上的Microsoft SQL Server（MSSQL）。它选择了这种设置，因为微软的许可模式有着相当高的每核成本。SQL
    Server企业版的许可成本约为每核7000美元，因此这种方法增加了这些许可证的利用率。
- en: 3\. Agoda’s cloud strategy and usage
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 3. Agoda的云策略和使用
- en: The remainder of this article is a question-and-answer session between Idan
    and I. The questions are in italics.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 本文的其余部分是Idan和我的问答环节。问题以斜体形式出现。
- en: '*Agoda not moving to the cloud is interesting as it’s a “sibling” of Booking.com,
    which has started to move to the public cloud. So why has Agoda not done so?*'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: “Agoda没有迁移到云端是有趣的，因为它是Booking.com的“姐妹公司”，后者已经开始迁移到公共云。那么为什么Agoda没有这样做？”
- en: ‘I can’t speak for Booking.com, but in some cases I believe companies consider
    migration to the cloud as an opportunity to “restart” their infrastructure and
    solve existing scale/capacity issues. Our current position is that we’re happy
    and quite stable in terms of capacity and performance, so we have no urgent need
    to make drastic changes to how we do things. For us, a migration for the cloud
    needs to be an opportunity and not a solution to a problem; it must show benefits
    in terms of cost, velocity, quality, etc. So far, we haven’t been able to prove
    such merit in the migration.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: “我不能代表Booking.com发表评论，但在某些情况下，我认为公司考虑迁移到云端是一个“重新启动”基础设施并解决现有规模/容量问题的机会。我们目前的立场是，我们在容量和性能方面非常满意和稳定，因此我们没有迫切需要对我们的做事方式进行重大改变。对我们来说，迁移到云端需要是一个机会，而不是解决问题的方案；它必须在成本、速度、质量等方面显示出好处。到目前为止，我们还没有能够证明迁移的这种价值。
- en: '**Our strategy is to get to a “cloud ready” state.** We have neither a “yes,
    we need to be on the cloud” nor a “no, we will not move to the cloud” position.
    We want to get to the “we don’t really care where we operate” state; this is our
    strategy. How do we get there? Firstly, we don’t use expensive setup like SANs
    ([Storage Area Networks](https://en.wikipedia.org/wiki/Storage_area_network?ref=blog.pragmaticengineer.com)).
    We took a cheaper approach for our hardware stack. By moving all our workloads
    to Kubernetes, we can easily migrate to a cloud provider, if needed.'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: “我们的策略是达到一个“云就绪”状态。” 我们既没有“是的，我们需要在云端”也没有“不，我们不会迁移到云端”的立场。我们希望达到“我们不在乎在哪里操作”的状态；这是我们的策略。我们如何实现这一点？首先，我们不使用昂贵的设置，比如SAN（存储区域网络）。我们为我们的硬件堆栈采取了更便宜的方法。通过将所有工作负载迁移到Kubernetes，我们可以轻松地迁移到云服务提供商，如果需要的话。
- en: Becoming “cloud ready” was why we moved off the HDFS protocol to S3, and why
    we are hedging our infrastructure ownership by using a few vendors in critical
    areas. For example, we use VAST as a vendor for storage, rather than self-hosted
    HDFS clusters.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 成为“云就绪”是我们从HDFS协议转移到S3的原因，也是我们通过在关键领域使用几家供应商来对冲基础设施所有权的原因。例如，我们使用VAST作为存储供应商，而不是自托管的HDFS集群。
- en: We are pretty close to our “cloud-ready” goal. We do “lift and shift” exercises
    a few times every year, which is how we hedge our dependency on our on-prem infrastructure.
    We’re ready to move if some disaster were to strike when access to the infra was
    lost, for example.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 我们离“云就绪”目标相当近了。我们每年进行几次“搬迁和转移”练习，这是我们对本地基础设施依赖的一种保护。如果发生灾难导致无法访问基础设施，我们已经准备好搬迁。
- en: There’s a lot of groundwork that goes into these exercises. We work with the
    cloud provider, set up a fiber connection with them, set up databases there, and
    do the lift-and-shift exercises. Over the years, we’ve become more efficient in
    setting up the experiment. For example, initially, we set up virtual machines
    to run in the cloud and we had to have all those virtual machines running, even
    when not in use. These days, we use Kubernetes and spin up the containers when
    we do the exercise.’
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 这些练习需要做很多基础工作。我们与云服务提供商合作，与他们建立光纤连接，在那里设置数据库，并进行搬迁练习。多年来，我们在设置实验方面变得更加高效。例如，最初，我们设置虚拟机在云中运行，即使不使用也必须让所有这些虚拟机运行。如今，我们使用Kubernetes，在进行练习时启动容器。
- en: '*What about using the cloud to “scale out” your operations, for example during
    peak loads?*'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: “关于使用云来“扩展”您的运营，例如在高峰负载期间？”
- en: ‘We actually looked into scaling loads out, but this turns out to be not so
    simple. Our original idea was to spin up the cloud only for peak traffic, or during
    high traffic periods. However, it turned out that providers are not particularly
    optimized to guarantee 50,000 cores being available for 2 hours usage per day.
    And this makes sense from their point of view; after all, what would they do with
    all those cores the rest of the time?
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: “我们实际上研究了扩展负载，但事实证明这并不那么简单。我们最初的想法是仅在高峰流量或高流量时期为云端提供服务。然而，事实证明供应商并没有特别优化来保证每天有50,000个核心可供使用2小时。从他们的角度来看，这是有道理的；毕竟，其他时间他们会怎么处理所有这些核心呢？
- en: '**There are some use cases where we do use the public cloud.** An example is
    CI/CD, which is a smaller use case, and we’re okay with spending more than if
    we ran jobs on-prem. In return, we have guaranteed SLAs on how quickly builds
    will finish, regardless of how many builds happen in parallel. Having these SLAs
    means our developers can iterate quicker.'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: “有一些用例我们确实使用公共云。” 一个例子是CI/CD，这是一个较小的用例，我们可以接受比在本地运行作业更多的花费。作为回报，我们有保证的SLA，无论有多少并行构建，构建将在多快的时间内完成。有了这些SLA，我们的开发人员可以更快地迭代。
- en: For massive production use cases when we would need to put in a large ask for
    a cloud provider; it would not make financial sense without a significant baseline
    budget commitment.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 在大规模生产用例中，如果我们需要向云服务提供商提出大量要求，而没有明显的基准预算承诺，这在财务上是不合理的。
- en: Even with fiber connections, it’s hard to have fast enough connections from
    a service to the database. So if we want to keep our databases “warm” on the cloud
    at all times, that would incur a baseline cost. This cost is the latency between
    databases like our MSSQL, Couchbase, ScyllaDB and other instances, and our microservices.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 即使有光纤连接，从服务到数据库的连接速度也很难达到足够快。因此，如果我们想始终在云上保持数据库“热”，那将产生基线成本。这个成本是我们的MSSQL、Couchbase、ScyllaDB和其他实例之间的延迟，以及我们的微服务之间的延迟。
- en: While we *could* rebuild our systems to handle higher latency from the authoritative
    database without much user impact, the centralized cache engines would need to
    be kept “warm” in some way within the cloud. This baseline cost is also why we
    don’t “burst to the cloud” for production services, at present.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我们*可以*重建我们的系统以处理来自权威数据库的更高延迟而几乎不影响用户，但集中式缓存引擎需要以某种方式在云中保持“热”。这也是为什么我们目前不会为生产服务“突发到云端”的基线成本。
- en: '**We have approaches for handling traffic spikes** without scaling to the public
    cloud. They include:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '**我们有处理流量峰值的方法**，而不是扩展到公共云。这些方法包括：'
- en: Shifting traffic between datacenters. This works well as our data centers have
    different peak schedules in different regions.
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在数据中心之间转移流量。这在我们的数据中心在不同地区具有不同的高峰时间表时效果很好。
- en: Degrading features for exceptional spikes, instead of buying more servers to
    ensure we can handle any type of spike.
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于异常的峰值，我们会降级功能，而不是购买更多服务器来确保我们可以处理任何类型的峰值。
- en: An idea for the future is that in the case of extreme spikes, we would shift
    part of this load to the data engineering DC. Currently, we do not shift load
    to the data engineering clusters during spikes.’
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 未来的一个想法是，在极端峰值的情况下，我们将部分负载转移到数据工程数据中心。目前，在峰值期间我们不会将负载转移到数据工程集群。
- en: 4\. The cloud or your own data centers?
  id: totrans-76
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 4\. 云端还是您自己的数据中心？
- en: '*For small enough companies, it’s pretty clear that onboarding to the cloud
    has lots of advantages. But what advice would you give a scaleup or a midsize
    company evaluating whether to operate their own data centers, or to onboard to
    the cloud?*'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '*对于规模足够小的公司，很明显，上云有很多优势。但您会给正在评估是自己运营数据中心还是上云的规模化或中型公司提出什么建议？*'
- en: '**‘Use knowledge-driven decision making.** Decisions that come from ignorance
    are poor ones, such as “everyone else does it, so we should as well,” or “what
    we have works and I’m afraid of trying this new technology.” On the other hand,
    decisions that come from *actual* knowledge and understanding are good decisions!
    So gather the knowledge and make sure it applies to your situation. Avoid [cargo
    culting](https://en.wikipedia.org/wiki/Cargo_cult?ref=blog.pragmaticengineer.com)
    – when you imitate things you don’t understand!’'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '**‘做出基于知识的决策。** 从无知而来的决策是糟糕的，比如“其他人都这样做，所以我们也应该这样做”，或者“我们现在的系统运行良好，我害怕尝试这种新技术。”
    另一方面，基于*实际*知识和理解的决策是好决策！因此，收集知识并确保它适用于您的情况。避免[模仿](https://en.wikipedia.org/wiki/Cargo_cult?ref=blog.pragmaticengineer.com)
    - 当您模仿您不理解的事物时！’'
- en: Have the expertise and investment to operate on-prem
  id: totrans-79
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 具备在本地运营的专业知识和投资
- en: '**‘Get into a position where you don’t have to care too much about whether
    or not you are on the cloud.** The best position to be in is not caring about
    whether you run your own infrastructure, or onboard to the cloud. Get your application
    stack in a shape whereby you can operate in either setting. Then you can objectively
    make infrastructure changes much quicker than if you’re locked in to on-prem or
    the cloud.'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '**‘使自己处于一个不必太在意是否在云上的位置。** 最好的位置是不必关心您是在运行自己的基础设施，还是上云。将您的应用程序堆栈整理得可以在任何环境中运行。然后，您可以比锁定在本地或云端更快地进行基础设施更改。'
- en: Be “cloud-ready” while running on-prem. Even if you run on-prem, ensure you
    use technology you can shift to the cloud relatively easily. For example, using
    Kubernetes as orchestration and the S3 protocol for data, are all choices we made
    in running our stack on-prem, which are also “cloud-ready” choices.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在本地运行时要“云就绪”。即使在本地运行，也要确保您使用的技术相对容易转移到云端。例如，在本地运行我们的堆栈时所做的选择，如使用Kubernetes作为编排工具和S3协议用于数据，都是我们所做的“云就绪”选择。
- en: '**Avoid software that locks you in**. Proprietary software can lock you into
    a given provider, making it very hard – and expensive – to move.'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '**避免将您锁定的软件**。专有软件可能会将您锁定在特定提供商，使得转移变得非常困难和昂贵。'
- en: '**Be aware of the margins of each cloud service. Are the charges worth it for
    your use case?** The cloud is not just for getting machines to use; it includes
    an ecosystem of services as well.'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '**了解每个云服务的边际。这些费用是否值得您的使用情况？** 云不仅仅是为了获取机器使用；它还包括一系列服务生态系统。'
- en: At least some of these services are running software that is easy to maintain
    and run and have no licensing cost. Still, the providers are still incentivized
    to “scare” you into believing you cannot manage it by yourself. It’s important
    to make that judgment with your own team and come to a knowledgeable decision.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 至少一些服务正在运行易于维护和运行的软件，并且没有许可成本。尽管如此，供应商仍然有动机“吓唬”您，让您相信自己无法自行管理。重要的是要与您自己的团队做出判断，并做出明智的决定。
- en: The focus on the expertise needed and whether you can manage it yourself, is
    a kind of fear-mongering that has been very strong in selling the cloud. In some
    cases this makes sense. For example, the US is an aggressive market where super
    talented people who know the cloud services inside-out can work for the companies
    that build those services, and great engineers often prefer to work at the “source.”
    But then, when you look at Agoda, we are pretty much the only company in Thailand
    that does anything like this so in-depth.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 关注所需的专业知识以及您是否能自行管理，这种恐惧营销在销售云服务中非常强烈。在某些情况下，这是有道理的。例如，美国是一个激烈的市场，那里有非常了解云服务的超级人才可以为构建这些服务的公司工作，而优秀的工程师通常更愿意在“源头”工作。但是，当您看看Agoda时，我们几乎是泰国唯一一家做到这一点如此深入的公司。
- en: If I’d come to Silicon Valley to convince a talented developer to come to Thailand
    to work for Agoda, it would be hard. But for developers based in this part of
    the world, we’re a shining star doing interesting, exciting and challenging stuff,
    plus we’re almost the only ones going all the way down to infrastructure-level.
    In our geographical area, we’re unique.’
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我去硅谷说服一位才华横溢的开发者来泰国为Agoda工作，那将是困难的。但对于这个地区的开发者来说，我们是一个闪亮的明星，做着有趣、激动人心和具有挑战性的工作，而且我们几乎是唯一一家一直致力于基础设施层的公司。在我们的地理区域，我们是独一无二的。
- en: When you’re already on the cloud
  id: totrans-87
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 当你已经在云上时
- en: '**‘Don’t let teams use whatever they want in the cloud**. Here’s the thing,
    onboarding is *always* super easy. However, offboarding can be hard to impossible!
    This type of lock-in is the biggest risk of the cloud in my view. One way to work
    around lock-in is to force the use of at least two cloud providers across the
    organization, and only allow onboarding to services on one cloud provider if they
    can be migrated to the other provider.'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '**‘不要让团队在云中使用他们想要的任何东西**。这里的问题是，入职总是非常容易的。然而，离职可能会很困难甚至不可能！在我看来，这种锁定是云的最大风险。解决锁定的一种方法是强制组织中至少使用两个云服务提供商，并且只允许将服务接入到一个云服务提供商，如果它们可以迁移到另一个提供商。'
- en: '**Be conservative about adding new technology dependencies.** Don’t add one
    unless it *really* adds a new capability you cannot support in your current stack.
    In other words, don’t increase the stack size itself unless you really have no
    choice!'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 对于添加新技术依赖要保守。除非它真的增加了你当前技术栈无法支持的新功能，否则不要添加。换句话说，除非你真的别无选择，否则不要增加技术栈的大小！
- en: The same goes for taking on cloud service dependencies. I’ve seen a *lot* of
    cloud services be acquired, or suddenly pivot, or be shut down. When this happens,
    if you have a dependency on such a service, you are left with an “ultimatum” of
    needing to find a new solution, and you start from scratch in the search. This
    is a very real risk that’s worth calculating.’
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 对于使用云服务依赖也是一样。我见过很多云服务被收购、突然转向或关闭的情况。当这种情况发生时，如果你对这样的服务有依赖，你就会面临一个“最后通牒”，需要找到一个新的解决方案，并且你需要从头开始搜索。这是一个非常真实的风险，值得计算。
- en: Takeaways
  id: totrans-91
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 要点
- en: Thanks very much to [Idan](https://www.linkedin.com/in/idan-zalzberg-a2300013?ref=blog.pragmaticengineer.com)
    for generously sharing so much detail about Agoda’s journey in operating on-prem,
    and its thinking about using the cloud. *Although Idan did not ask me to mention
    this, I will add that Agoda* [*is hiring*](https://careersatagoda.com/?ref=blog.pragmaticengineer.com)
    *in several locations across Asia.*
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 非常感谢[Idan](https://www.linkedin.com/in/idan-zalzberg-a2300013?ref=blog.pragmaticengineer.com)慷慨地分享了Agoda在运营本地和使用云的过程中的许多细节。*尽管Idan没有要求我提及这一点，我会补充说Agoda*
    [*正在亚洲多个地点招聘*](https://careersatagoda.com/?ref=blog.pragmaticengineer.com)。
- en: Here are few takeaways worth taking from Agoda’s journey, especially as we contrast
    it to [that of Uber’s](https://newsletter.pragmaticengineer.com/p/uber-move-to-cloud?ref=blog.pragmaticengineer.com).
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是从Agoda的旅程中学到的一些值得注意的地方，特别是与[Uber的旅程](https://newsletter.pragmaticengineer.com/p/uber-move-to-cloud?ref=blog.pragmaticengineer.com)进行对比。
- en: '**Every business has unique constraints**. Agoda operates in Asia, where the
    cost of labor is lower than the US and Europe, but where public cloud costs are
    higher. The company has been in business for almost 20 years and has always managed
    its own infrastructure.'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '**每家企业都有独特的限制**。Agoda在亚洲运营，劳动力成本低于美国和欧洲，但公共云成本更高。该公司已经经营了近20年，并且一直管理自己的基础设施。'
- en: 'It has hardware buyers, people installing and maintaining machines, and folks
    building the software infrastructure layer to run on top of virtual machines.
    Agoda employs tens of people to manage the infrastructure layer, and probably
    around 100 people who work on various parts of infrastructure and DevOps. Here’s
    a breakdown of employee numbers from Idan:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 它有硬件采购员，安装和维护机器的人员，以及构建软件基础设施层以在虚拟机上运行的人员。Agoda雇佣了数十人来管理基础设施层，并且大约有100人在基础设施和DevOps的各个部分工作。以下是Idan提供的员工人数的细分：
- en: Tens of people (between 10 and 30) maintaining hardware
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 维护硬件的人数在10到30人之间
- en: 25-30 people maintaining data infrastructure like Kafka or RabbitMQ.
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 维护Kafka或RabbitMQ等数据基础设施的25-30人。
- en: 20-30 people working in the database administration area
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在数据库管理领域工作的20-30人
- en: The teams who build and maintain solutions like Fleet
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 构建和维护类似Fleet解决方案的团队
- en: If your company is in a similar position in terms of infra needs, and engineering
    headcount; and has made similar investments in infrastructure, then you might
    also be able to set up and operate your own infrastructure. If not, it doesn’t
    mean you cannot! Treat all details in this article as examples of approaches,
    not instructions which your company should closely follow.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的公司在基础设施需求和工程人员数量方面处于类似的位置，并且已经对基础设施进行了类似的投资，那么你可能也能够建立和运营自己的基础设施。如果不是，也不意味着你不能！将本文中的所有细节视为方法的示例，而不是你的公司应该严格遹循的指导。
- en: '* * *'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: 'The above was about a third of the topics discussed in two subscriber-only
    deepdive articles about Agoda’s private data centers. [The full article series](https://newsletter.pragmaticengineer.com/p/inside-agodas-private-cloud?ref=blog.pragmaticengineer.com)
    covers these additional topics:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 以上是关于Agoda私有数据中心的两篇仅限订阅者的深度文章中讨论的大约三分之一的主题。[完整的文章系列](https://newsletter.pragmaticengineer.com/p/inside-agodas-private-cloud?ref=blog.pragmaticengineer.com)涵盖了以下额外主题：
- en: '**Internet service provider (ISP) basics.** What are tier 1, 2 and 3 ISPs?
    Why does it matter? And why does Agoda connect to a Tier 1 one?'
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**互联网服务提供商（ISP）基础知识。** 什么是一级、二级和三级ISP？为什么这很重要？为什么Agoda要连接到一级ISP？'
- en: '**Data center tiering.** How tiers 1-4 for data centers measure up, and which
    tiers do popular cloud providers certify as? Why does Agoda co-locate with Tier
    3-or-above?'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**数据中心分级。** 数据中心的1-4级如何衡量，流行的云服务提供商认证为哪些级别？为什么Agoda要与三级或以上的数据中心共同使用？'
- en: '**The evolution of data centers at Agoda**. From blade servers and Windows
    machines in 2012, to an in-house, Kubernetes-based orchestrator development system
    today.'
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Agoda数据中心的演变**。从2012年的刀片服务器和Windows机器，到如今基于Kubernetes的内部编排器开发系统。'
- en: '**Data centers (DCs) and availability zones.** How does the company organize
    its two regions, and which services use active-active or active-passive DC setups?'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**数据中心（DCs）和可用性区域。** 公司如何组织其两个地区，哪些服务使用主动-主动或主动-被动的DC设置？'
- en: '**The application stack inside the private cloud.** Fleet, Buckbeak, Agoda’s
    detailed data stack and bespoke developer portal.'
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**私有云中的应用程序堆栈。** Fleet，Buckbeak，Agoda的详细数据堆栈和定制开发者门户。'
- en: '**To move or not to move to the cloud.** How Agoda knows if it’s time to move
    away from on-prem servers. Are location-based expenses keeping the company off
    public clouds?'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**迁移到云端还是不迁移到云端。** Agoda如何知道是时候远离本地服务器了。基于位置的费用是否让公司远离公共云？'
- en: '**A surprise advantage of hiring software engineers**. Owning their own stack
    end-to-end comes with unexpected hiring benefits, when attracting developers.'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**雇佣软件工程师的一个意外优势**。拥有端到端的自有堆栈带来意想不到的招聘优势，吸引开发人员。'
- en: '**Agoda’s learnings from operating its own DCs.** The importance of standardizing,
    and why to minimize your tech stack.'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Agoda从运营自己的DC中学到的经验。** 标准化的重要性，以及为什么要尽量减少技术堆栈。'
- en: '[Read the full article series here](https://newsletter.pragmaticengineer.com/p/inside-agodas-private-cloud?ref=blog.pragmaticengineer.com).'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '[在此阅读完整文章系列](https://newsletter.pragmaticengineer.com/p/inside-agodas-private-cloud?ref=blog.pragmaticengineer.com)。'
- en: '* * *'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: Featured Pragmatic Engineer Jobs
  id: totrans-113
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 精选Pragmatic Engineer职位
- en: '*The above jobs score at least 10/12 on [The Pragmatic Engineer Test](https://blog.pragmaticengineer.com/pragmatic-engineer-test/).
    Browse more senior engineer and engineering leadership roles with great engineering
    cultures, or add your own on [The Pragmatic Engineer Job board](https://pallet.xyz/list/pragmatic-engineer/jobs)
    and apply to join [The Pragmatic Engineer Talent Collective](https://pragmatic-engineer.pallet.com/talent).*'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '*以上工作至少在[The Pragmatic Engineer Test](https://blog.pragmaticengineer.com/pragmatic-engineer-test/)中得分为10/12。浏览更多拥有出色工程文化的高级工程师和工程领导职位，或在[The
    Pragmatic Engineer Job board](https://pallet.xyz/list/pragmatic-engineer/jobs)上添加您自己的职位，并申请加入[The
    Pragmatic Engineer Talent Collective](https://pragmatic-engineer.pallet.com/talent)。*'
- en: '**Want to get interesting opportunities from vetted tech companies?** Sign
    up to [The Pragmatic Engineer Talent Collective](https://pragmatic-engineer.pallet.com/talent)
    and get sent great opportunities - similar to the ones below without any obligation.
    You can be public or anonymous, and I’ll be curating the list of companies and
    people.'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '**想要从经过审核的科技公司获得有趣的机会吗？** 注册[The Pragmatic Engineer Talent Collective](https://pragmatic-engineer.pallet.com/talent)
    并获得伟大的机会 - 与下面的机会类似，没有任何义务。您可以选择公开或匿名，我将精选公司和人员名单。'
- en: '**Are you hiring senior+ engineers or engineering managers?** Apply to join
    [The Pragmatic Engineer Talent Collective](https://pragmatic-engineer.pallet.com/talent)
    to contact world-class senior and above engineers and engineering managers/directors.
    Get vetted drops twice a month, from software engineers - full-stack, backend,
    mobile, frontend, data, ML - and managers currently working at Big Tech, high-growth
    startups, and places with strong engineering cultures. [Apply here](https://pragmatic-engineer.pallet.com/talent).'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '**您是否在招聘高级工程师或工程经理？** 申请加入[The Pragmatic Engineer Talent Collective](https://pragmatic-engineer.pallet.com/talent)
    与世界一流的高级工程师和工程经理/总监联系。每月两次获得经过审核的投递，来自目前在大型科技公司、高增长初创公司和拥有强大工程文化的地方工作的软件工程师 -
    全栈、后端、移动端、前端、数据、机器学习和经理。[在这里申请](https://pragmatic-engineer.pallet.com/talent)。'
