# Datadog 每年 6500 万美元客户之谜解开了

> 原文链接：[`newsletter.pragmaticengineer.com/p/datadogs-65myear-customer-mystery`](https://newsletter.pragmaticengineer.com/p/datadogs-65myear-customer-mystery)

*👋 嗨，我是 [Gergely](https://twitter.com/gergelyorosz)，这是《务实工程师通讯》的免费额外问题。在每期中，我通过工程经理和高级工程师的视角涵盖与大型科技公司和高增长初创公司相关的主题。在本期中，我们从今天的订阅者专属 [The Scoop 文章](https://newsletter.pragmaticengineer.com/p/the-scoop-47) 中涵盖了六个主题中的一个。要获取每周两次的完整问题，请订阅：*

Datadog 是一家领先的可观察性工具提供商，于 2019 年上市，当前市值为 280 亿美元。该公司在 2022 年实现了 16.7 亿美元的营收，约为每月 1.4 亿美元。在一周前的财报电话会议上，即 5 月 4 日，首席财务官提到了“一笔大额预付账单，未重复”，说道：

> “账单为 5.11 亿美元，同比增长 15%。我们在 2022 年第一季度为一个客户有一笔大额预付账单，但在 2023 年第一季度，这种水平或时间上的账单并未重复。剔除这个客户后，账单增长率为低 30%。”

如果你像我一样，可能会忽略这个细节，因为这里 15%，那里 30%。然而，分析师参加这些电话会议，他们的核心工作是分析数据，找出公司可能试图隐藏的东西。一位 JP 摩根的股票分析师就是这样做的，迅速计算数字并提出问题：

> “David，看着这笔大额预付账单的数学，这笔账单似乎约为 6500 万美元，如果我算对了的话。你能否再多解释一点？”

Datadog 的首席财务官 David Obstler 给出了更多细节：

> “那是一个继续成为我们客户的加密公司。但那是一个早期的优化器。我们一直在谈论一些受影响最大且被优化的行业。”

那么，这家神秘的加密公司是谁？投资者 Turner Novak 推测是 Coinbase：

他补充说，他并不确定这是 Coinbase，因为过去几年其他加密公司也筹集了很多资金。

那么，Coinbase 在 2022 年是否在 Datadog 上花费了 6500 万美元？在线上有很多理论，或者假装是 Coinbase 员工的人，比如这位匿名评论者在 Hacker News 上声称，这 6500 万美元是为了 3 年的预付款（这个信息我无法验证）。我想找到真相，所以我联系了公司的软件工程师。我得到了答案：

**是的。Coinbase 在 2021 年与 Datadog 花费了 6500 万美元，这是他们当年的应付账单。** 我可以确认这一点，因为我与 Coinbase 的现任和前任软件工程师交谈过，他们分享了发生的情况细节。

这是 Datadog 的首席执行官在财报电话会议上解释发生了什么：

> “这是那种在过去一年中几乎被摧毁的行业的情况之一。他们自己的业务收入减少了三分之一或四分之一。在这种情况下，我们真的会与客户合作重新调整他们与我们的合同。我们希望成为他们问题的一部分，而不是问题的一部分(...) 我们重新调整他们的合同，以便让他们成为更多年的快乐客户，并与他们的业务概况达成对每个人都有利的交易。”

这是我从与 Coinbase 工程师交谈中了解到的实际情况。

Coinbase 在 2021 年表现出色，不必担心成本。该公司于当年 6 月上市，市值高达惊人的 860 亿美元。相比之下，将近两年后，该公司的估值约为 140 亿美元，下降了 75%。

在繁荣时期，交易量激增，一次又一次打破记录，Coinbase 几乎跟不上。以下是 Coinbase CEO Brian Amstrong 对此的总结：

> “显然，2021 年对 Coinbase 来说是一个不可思议的一年，这种事情在你的一生中很少见，也很少在商业生涯中见到(...) 我们的月活跃用户数达到了历史最高的 1140 万，同比增长了 4 倍，增长了 400%，非常不可思议。”

在 2021 年夏季上市后，公司没有人关心基础设施成本；唯一的关注点是增长。该公司为 AWS、Snowflake 和 Datadog 等公司产生了巨额账单。因此，2021 年 Datadog 的账单为 6500 万美元。Coinbase 在 2022 年第一季度结清了账单。

**在 2022 年初，Coinbase 突然需要削减基础设施支出。** 加密行业突然陷入寒冷，影响了 Coinbase 的业务。随着收入枯竭，公司开始关注减少过高的成本。

为了实现可观察性，Coinbase 成立了一个专门团队，旨在摆脱 Datadog，转而使用 Grafana/Prometheus/Clickhouse 堆栈。这些技术的简要概述：

**[Prometheus](https://prometheus.io/)：一个时间序列数据库。** 这是一个非常受欢迎的开源解决方案，用于系统和服务监控。Prometheus 会在给定的时间间隔内从配置的目标（服务）收集指标。它会评估规则并触发警报。它主要使用 Go 编写，还有一些 Java、Python 和 Ruby 部分。Prometheus 会将时间序列存储在内存和存储（HDD 或 SSD）中，使用高效且自定义的格式，并支持[分片](https://en.wikipedia.org/wiki/Shard_(database_architecture))和[联邦](https://en.wikipedia.org/wiki/Federated_database_system)。

Prometheus[是](https://www.cncf.io/projects/prometheus/)云原生基金会的一部分，加入该基金会表明可以放心构建在 Prometheus 之上，因为它正在积极维护并将继续维护。

Prometheus 可以自行托管，但几家云服务提供商也提供托管的 Prometheus 服务：Google Cloud 和 AWS 都在生产中提供此服务，而 Azure 则在预览中提供。

**[Grafana](https://grafana.com/)：可视化指标的前端。** Grafana 是一种流行的源分析和监控可视化解决方案。如果您需要显示或深入了解指标或警报，这是首选工具，并且在技术公司中被广泛使用。当我在 Uber 时，Grafana 支持我们许多的图表。这里是一个您可以[尝试的 Grafana 仪表板](https://play.grafana.org/d/000000012/grafana-play-home?orgId=1)的示例：

**[Clickhouse](https://clickhouse.com/)**：日志管理。一种快速且开源的面向列的数据库管理系统，是日志管理的热门选择。Clickhouse 主要用 C++编写，并在整个行业广泛使用。例如，Cloudflare 使用 Clickhouse 存储其所有 DNS 和 HTTP 日志 - 每秒超过 10M 行！ - 而 Uber 将 Clickhouse 用作其中央日志平台。

Coinbase 启动了其内部方法，不是为了节省成本，而是为了完全控制和拥有可观察性。可观察性和可靠性是 Coinbase 的主要差异化因素，因为它为公司带来了与竞争对手的竞争优势。

然而，随着加密市场降温，成本成为主要关注焦点，很明显内部的 Grafana/Prometheus 解决方案要便宜得多。Coinbase 团队已经双写了新堆栈数月，确认一切运作良好，并解决任何问题。

*我们在问题[Migrations done well](https://newsletter.pragmaticengineer.com/p/migrations)中涵盖了双写等方法。*

因此，Coinbase 准备放弃 Datadog，但 Datadog 在最后一刻通过提出一个非常吸引人的交易挽救了与 Coinbase 的客户关系。未来，Datadog 的账单不会接近 2021 年的$65M。正如 Brian Amstrong 在 2021 年对加密市场所说，$65M 的账单在商业生涯中是非常罕见的事情。

我询问了在 Coinbase 使用内部堆栈和 Datadog 的工程师对于决定继续使用 Datadog 的看法。他们表示，考虑到合理的成本和优越的 Datadog 开发体验，这最终是正确的决定。

Coinbase 最终可能会自行设计出类似的体验。然而，要提供类似无缝的开发者体验，可能需要数十年的工程时间。

**“昂贵”在可观察性工具中是相对的。** 让我们假设今天 Coinbase“仅”每年在 Datadog 上花费了，比如说，$10M。这是否太多了？看看头条数字，很容易这样认为。

然而，让我们深入一层。像 Datadog 这样的平台有助于预防故障，立即检测到故障并更快地减轻故障。在 2022 年，Coinbase 共发生了 17 次故障，总计约 12 小时的停机时间。该公司的日均收入约为每天$9M，基于他们 2022 年的收入。

假设 Datadog 通过早期监控防止故障，将故障数量减半。这意味着如果没有 Datadog，我们将面临 24 小时的停机时间，而不是 12 小时。让我们还假设使用 Datadog 比没有 Datadog 时能够更快地减轻故障 - 由于能够将健康指标与日志连接起来，更快地进行调试，快速定位根本原因并更快地减轻。在这种情况下，如果没有 Datadog，我们可能会面临 36 小时的总停机时间，而不是有 Datadog 时的 12 小时。用数字来说：公司将获得大约 900 万美元的收入，否则将会损失，现在这 1000 万美元/年的费用实际上是自给自足的！

**我们可以从 Coinbase 的成本削减行动中学到什么？** 供应商们对于客户减少支出保持缄默，Datadog 偶然透露了足够的线索，找出了他们的大型“早期优化”客户是谁，并了解更多细节。但 Coinbase 的故事是个例吗？

我不确定是这样。三个月前，我报道了[科技公司正在积极削减供应商支出](https://newsletter.pragmaticengineer.com/p/vendor-spend-cuts)的趋势 - 两个月后，华尔街日报也[报道](https://www.wsj.com/articles/corporate-technology-under-new-scrutiny-amid-recession-fears-a69c6583)了同样的主题。对我来说，Coinbase 似乎是早期参与成本优化趋势的公司。然而，仔细看看我收集的[回应](https://newsletter.pragmaticengineer.com/p/vendor-spend-cuts)，“AWS”和“Datadog”是被提及最多的两家供应商，作为节约成本的目标。这仅仅是因为基础设施和可观察性成本往往是最高的，AWS 是云基础设施的领导者，Datadog 是可观察性的领导者。

Datadog 首席执行官 Olivier Pomel 确认，这种优化正在发生在他们所有客户身上，他说：

> “当我们查看我们的数据，当我们听取超大规模运算商的意见时，我们也仔细倾听他们对未来的预测，我们没有看到任何让我们确信我们可以在下个季度或之后结束优化的迹象。因此，就我们的指导和今年的计划而言，我们假设这种情况将在今年余下的时间内保持在类似水平。”

我已经确认了几家拥有数千名工程师构建自己的 Grafana/Prometheus 堆栈的大型公司，计划迁移出当前的可观察性供应商并自行运营可观察性堆栈。但是为什么会这样呢？

**每年超过 2-5 百万美元的年度支出是引入供应商内部化的时机。** 这是因为在这个数字左右，雇佣一个团队来做供应商正在做的事情的成本在*理论上*是有意义的。

一般来说，你可以将基础设施成本降低到供应商收费的水平以下。这是因为供应商和你可能都在使用相同的云基础设施提供商，通常是 AWS、GCP 或 Azure。然而，你需要雇佣和配备一个专门的工程团队来构建和运行该基础设施。

因此，从成本的角度来看，这是你需要解决的数学问题。在什么时候这个等式成立：

$基础设施成本 + $平台团队成本 < $当前供应商成本

在这个问题中，$平台团队成本将超过 100 万美元，有时甚至超过 200 万美元。这是因为你需要一个由 4-5 名工程师和一个经理组成的团队，他们的平均总薪酬将在每年 15-40 万美元之间，取决于你的成本基础。

当你的账单超过每年$2-3M 时，开始考虑自建而非购买可能会变得诱人。这个决定的经济学问题在于供应商在原始基础设施之上收取了多高的利润率？对于 Coinbase 来说，一个好奇的问题是：当谈论可以证明需要一个团队的巨额成本时，他们是否考虑过自建？

对于 Coinbase 来说，在支付了 6500 万美元账单后自建是一个明显的明智选择。他们可以在旧金山湾区雇佣一支由 10 名高级和员工级工程师组成的团队，而这支团队的成本仍然低于每年 500 万美元。然后他们只需要为基础设施成本预算，他们可以将其预计降低到每年两位数。

Coinbase 计划迁移离开 Datadog，但最终决定留下。然而，并不是唯一一个考虑将可观性引入内部的大型科技公司。我有另一个独家消息，甚至 Datadog 可能还不知道。这份报告涉及 Shopify 及其计划迁移离开 Datadog。但最近的裁员会改变情况吗？我在[完整的 The Scoop](https://newsletter.pragmaticengineer.com/p/the-scoop-47)中详细介绍了这个话题。

*这是本周 The Scoop 中涵盖的五个话题之一。我在 The Scoop 中分享的许多内容都是本刊独家的，这意味着它们在任何其他媒体上都没有报道过，你是第一个读到的人。*

*完整的 The Scoop 版还包括：*

1.  **Shopify 会迁移到内部的可观性工具吗？** Shopify 决定建立自己的可观性平台，并迁移离开 Datadog。这个计划看起来很确定，直到 Shopify 裁减了建立新平台的工程团队。接下来会发生什么？***独家***。

1.  **微软削减了薪酬目标**。大约一年前，微软员工收到了一个惊喜：他们可以期待比平时更高的薪酬增长。昨天，又收到了另一封意外的电子邮件，但其内容与去年相反。我与这家科技巨头的经理和工程师们讨论了对令人失望的薪酬消息的反应。***独家***。

1.  **Shopify 在德国裁员大部分员工**。作为裁员 20% 的一部分，德国大部分员工被解雇了。这些裁员发生在德国的一个工会选举前一周。这是不幸的时机，还是背后有更多的原因？***独家***。

1.  **乌克兰的高级薪酬趋势下降**。乌克兰是我们可以获得全国数据的少数几个国家之一，通过招聘网站 Djinni。今年上半年的数据已经出来了，它们指向了最近没有见过的情况：高级工程师的薪酬在下降。这是一个地方性趋势，还是我们会看到它在其他国家发生？*分析*。

1.  **本周公开的科技公司薪酬文章的后续报道**。为什么 Netflix 在名单上比许多软件工程师预期的要低？另外，关于 Roblox 的新细节以及为什么杰克·多西的总薪酬是 $2.75\. *跟进*。

[阅读完整的 The Scoop 这里。](https://newsletter.pragmaticengineer.com/p/the-scoop-47)
